---
title: "Reasoning for Contact Area Model"
author: "Alex Cebulski"
format: pdf
editor: source
---

The reasoning for using `sin` as a factor for increased contact area is as follows:

![Simplified diagram showing the contact area for non vertical snowfall hitting a triangle.](contact_area_triangle.png){#fig-tri}

Let:

-   $w_p$ be the contact width contributing to interception, i.e., a plane perpendicular to the snowfall that contacts the canopy as it moves through the canopy space
-   $h_c$ be the height of the canopy from the top down contacting snowfall 
-   $w_c$ be the width of the canopy at height $h_c$
-   $A_c$ be the area of the canopy in contact with snowfall
-   $\theta_h$ be the snowfall trajectory angle from zenith
-   $h_t$ be the vertical height of the canopy 
-   $w_t$ be the base width of the canopy

Then:

$$
w_p = \text{sin}(\theta_h) * h_t
$$

$$
h_c = \text{sin}(\theta_h) * w_p
$$

$$
w_c = \frac{w_t}{h_t} * h_c
$$

$$
A_c = h_c*\frac{w_c}{2}*2
$$

A lightly more precise calculation of $w_p$ which takes into account the tilting of the contact plane would be:

Let:

  - $\theta_b$ be the angle of the bottom right of the tree from vertical. 
  - $h_s$ be the length of the side of the tree aka hypotenuse 

Then:

$$
\theta_b = \text{atan}(\frac{w_t}{h_t}/h_t)
$$

$$
h_s = \sqrt{h_t^2 + (w_t/2)^2}
$$

$$
w_p = \text{sin}(\theta_b+\theta_h)*h_s
$$

```{r}
# Load ggplot2 library
library(ggplot2)

# Define parameters
h_t <- 5
w_t <- 5
theta_h <- 5 * (pi/180)

theta_b <- atan((w_t/2) / h_t)
stopifnot(theta_b<(pi/4))
h_s <- sqrt(h_t^2 + (w_t/2)^2)
w_p <- sin(theta_b + theta_h) * h_s
h_c <- sin(theta_h) * (w_p)
x <- h_c / tan(theta_h)

# Calculate w_b (the top side of the blue triangle)
w_b <- sqrt((w_t / 2)^2 + h_t^2)  # Using Pythagoras to calculate the top side

# Define the points of the green triangle
triangle_data <- data.frame(
  x = c(0, w_t, w_t / 2),
  y = c(0, 0, h_t),
  label = c("0", "w_c", "h_c")
)

# Define the points of the blue triangle
triangle_data2 <- data.frame(
  x = c(w_t / 2, w_t, (w_t / 2) + x),
  y = c(h_t, 0, h_t - h_c),
  label = c("0", "w_c", "h_c")
)

# Plot the triangle with labels
ggplot(triangle_data, aes(x, y)) +
  geom_polygon(fill = NA, color = "green", size = 1) +  # Create the green triangle
  geom_polygon(data = triangle_data2, aes(x, y), colour = "blue", fill = NA) +  # Blue triangle
  annotate("text", x = (w_t / 2 + (w_t / 2 + x)) / 2, y = h_t-1, label = "w_p", size = 4, color = "blue") +
  labs(x = "Width (m)", y = "Height (m)") +
  coord_fixed(ratio = 1)  # Ensure the triangle's proportions are fixed


```

For small $\theta_h$ we should also decrease $w_p$ as the increase on one side of the tree is balanced by the decrease in contacts on the right side:

w_p_left <- sin(theta_b - theta_h)*hyp 

which gives the contact length on the left side.
